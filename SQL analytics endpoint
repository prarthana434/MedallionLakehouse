-- SQL analytics endpoint

select 
o.years,
o.quarters,
o.months,
o.weeks,
o.year_month,
o.month_name,
o.day_name,
o.order_placement_date,
o.customer_id,
o.customer_name,
o.order_id,
o.product_id,
o.product_name,
o.category,
o.agreed_delivery_date,
o.actual_delivery_date,
o.in_full,
o.on_time,
o.on_time_in_full,
o.ontime_target,
o.infull_target,
o.otif_target,
sum(o.order_qty) sales_order_deta_size_quantity,
sum(o.delivery_qty) sales_order_size_ship_quantity,
ROUND(sum(ao.average_order_qty_per_customer),0) average_order_qty_per_customer,
sum(oc.total_orders_per_customer) total_orders_per_customer
from 
dbo.order_lines o
inner join dbo.average_order_value ao 
on o.customer_id = ao.customer_id
inner join dbo.orders_per_customer oc on 
o.customer_id = oc.customer_id
inner join total_items_per_customer pc on 
o.customer_id = pc.customer_id
group by 
o.years,
o.quarters,
o.months,
o.weeks,
o.year_month,
o.month_name,
o.day_name,
o.order_placement_date,
o.customer_id,
o.customer_name,
o.order_id,
o.product_id,
o.product_name,
o.category,
o.agreed_delivery_date,
o.actual_delivery_date,
o.in_full,
o.on_time,
o.on_time_in_full,
o.ontime_target,
o.infull_target,
o.otif_target
